{% capture header_account_dropdown %}
  <ul class="header__account_dropdown_content list-none header-account-shadow">
    {% for link in linklists.account_menu.links -%}
      {% if link.type == 'api_request' %}
        <li>
          <form action-xhr="{{ link.url }}" method="POST" refresh-when-submit-success>
            <button class="clear text-inherit " type="submit">{{link.title}}</button>
          </form>
        </li>
      {% else %}
        <li><a href="{{ link.url}}">{{ link.title }}</a></li>
      {% endif %}
    {%- endfor %}
  </ul>
{% endcapture %}
<spz-observer
  layout="logic"
  target="header__plugin-container"
  @childUpdated="header-menu-top.updateMoreLink"
></spz-observer>
<div class="header__icons flex-shrink-0 flex items-center" {% if container_id %} id="{{ container_id }}" {% endif %}>
  {% comment %} plugin {% endcomment %}
  <div class="header__plugin-container md:hidden flex items-center" id="header__plugin-container">
    {% for block in section.blocks %}
      {% if block.type contains '//apps' %}
        <div>{% render block %}</div>
      {% endif %}
    {% endfor %}
    <div class="empty-hidden plugin__translate-header"></div>
    <div class="empty-hidden plugin__currency"></div>
  </div>

  {% if isShowInsideSearch %}
    {% render 'header_search', media: media %}
  {% endif %}

  {%- comment -%} 账户 {%- endcomment -%}
  <div class="header__account relative text-0 {% if mb_menu_type == 'drawer' %} md:hidden {% endif %}">
    <i class="cursor-pointer" {% if media == 'md' %}@tap="header_account_dropdown_{{media}}.open"{% endif %}>{% include 'icon_account' %}</i>
    {% if media == 'pc' %}
      {{header_account_dropdown}}
    {% else %}
      <spz-dropdown class="header__account_dropdown" id="header_account_dropdown_{{media}}" layout="nodisplay" placement="bottom">
        {{header_account_dropdown}}
      </spz-dropdown>
    {% endif %}
  </div>
  {%- comment -%} 购物车 {%- endcomment -%}
  <a class="header__cart relative flex justify-end items-center text-0 text-inherit cursor-pointer no-underline" {% unless template.type == '13' %}{% if settings.cart_type == 'drawer' %}@tap="cart-drawer-modal.open"{% else %}href="{{ routes.cart_url }}"{% endif %}{% endunless %}>
    <i>
      {% if settings.cart_icon == 'cart' %}
        {% include 'icon_cart' %}
      {% else %}
        {% include 'icon_bag' %}
      {% endif %}
    </i>
    <!-- 购物车数量 -->
    <spz-event target-id="header_cart_count_render_{{media}}" target-api="render" event-name="dj.addToCart;dj.cartChange;" layout="logic"></spz-event>
    <spz-render id="header_cart_count_render_{{media}}" layout="container" src="{{ '/api/cart/count' | add_root_url }}">
      <template>
        <div>
          <span class="header__cart-count absolute rounded-full leading-none text-center" spz-if="${data.data && data.data.count > 0}">${data.data && data.data.count}</span>
        </div>
      </template>
    </spz-render>
  </a>
  {% if mb_menu_type == 'drawer' or is_force_menu_icon %}
    <i class="header__drawer_icon {% if is_force_menu_icon %} header__icon-menu--force {% endif %} flex lg:hidden cursor-pointer" @tap="{{section_prefix}}-announcement.toggleClass(class='header_mask_open', force=true);header_drawer.open()">
      {% include 'icon_menu' %}
    </i>
  {% endif %}
</div>