{% capture borderRadius %}
  {% if settings.button_edges == 'round' or settings.button_edges == 'slightly_round' %} rounded-btn-fixed {% else %} rounded-[1px] {% endif %}
{% endcapture %}

<template id="quick-shop-variant-template">
  <div class="quick-shop-variants-container">
    <div spz-for="(option, index) in data.product.options">
      ${function(){
        const optionName = option.name || '';
        const optionId = option.id || '';
        let isThumbImage = !!option.showThumbImage;
        const thumbStyle = {{ settings.product_thumb_style | json }};
        const variantType = {{ settings.product_variant_style | json }};
        const isSelected = (value) => {
          const selected = (data.selectedOptions || []).find(v => v.name === optionName);
          return selected && selected.value.length && selected.value[0] == value;
        };
        const getThumbImage = (value) => {
          const options = data.product.options || [];
          const option = options.find(o => o.name === optionName);
          if (option.thumbImages) {
            const thumbImage = option.thumbImages.find(t => t.value === value);
            if (thumbImage && thumbImage.image) {
              return {
                src: thumbImage.image.src,
                alt: thumbImage.image.alt
              };
            }
          }
          return {src: '', alt: ''};
        };
        return `
          <fieldset
            spz-if="${variantType=='button' || isThumbImage}"
            class="quick-shop__variants_content mt-6 mx-0 min-w-[0px]"
            name="${optionName}"
            @mouseout="quick-shop-selected-variant-${optionId}.rerender(data=event, redo=true);"
            @mouseover="quick-shop-selected-variant-${optionId}.rerender(data=event, redo=true);"
          >
            <legend class="quick-shop__variants_title">
              <span class="lg:body-plus-2 leading-1.3 inline-block">${optionName}:&nbsp;</span>
              <spz-render
                class="items-center opacity-60 inline-block flex-grow min-w-[0px] truncate"
                id="quick-shop-selected-variant-${optionId}"
                layout="container"
                template="quick-shop-selected-variant-template"
                manual
              >
                <span>${data.selectedOptions && data.selectedOptions.length && data.selectedOptions.find(v => v.name === optionName).value[0]}</span>
              </spz-render>
            </legend>
            <div class="flex flex-wrap ${isThumbImage ? 'mt-1' : 'quick-shop-variant-container'}">
              <div spz-for="(value, idx) in option.values" class="relative mt-3 mr-3" option="${value}">
                <input
                  checked
                  spz-if="isSelected(value)"
                  type="radio"
                  class="pointer-events-auto"
                  option="${value}"
                  id="quick-shop-variant-${value}-${idx}"
                  name="quick-shop-variant-${optionName}"
                  value="${value}"
                  form="quick-shop-body"
                  @input-debounced="quick-shop-selected-variant-${optionId}.rerender(data=event, redo=true);"
                >
                <input
                  spz-else
                  type="radio"
                  class="pointer-events-auto"
                  option="${value}"
                  id="quick-shop-variant-${value}-${idx}"
                  name="quick-shop-variant-${optionName}"
                  value="${value}"
                  form="quick-shop-body"
                  @input-debounced="quick-shop-selected-variant-${optionId}.rerender(data=event, redo=true);"
                >
                <label
                  class="quick-shop-variant-option break-words {{ borderRadius }}"
                  data-type="${isThumbImage ? (thumbStyle == 'image_with_text' ? 'image-with-text' : 'image') : 'text'}"
                  for="quick-shop-variant-${value}-${idx}"
                >
                  <spz-img
                    spz-if="${!!isThumbImage}"
                    src="${getThumbImage(value).src}"
                    layout="responsive"
                    width="42"
                    height="42"
                    alt="${getThumbImage(value).alt}"
                    object-fit="cover"
                    auto-fit
                  ></spz-img>
                  <span spz-if="${thumbStyle == 'image_with_text' || !isThumbImage}" class="break-words"
                    >${value}</span>
                </label>
              </div>
            </div>
          </fieldset>
          <div spz-else class="mt-6">
            <div class="lg:body-plus-2 leading-1.3">${optionName}</div>
            <div class="relative mt-3">
              <select
                class="quick-shop__variant__select pointer-events-auto w-full text-text-font-size type-text-font-family {{ borderRadius }} secondary-select"
                role="variant"
                name="${optionName}"
              >
                <option
                  spz-for="value in option.values"
                  spz-if="isSelected(value)"
                  class="quick-shop__variants_value"
                  value="${value}"
                  option="${value}"
                  selected
                >
                  ${value}
                </option>
                <option
                  spz-for="value in option.values"
                  spz-if="${!isSelected(value)}"
                  class="quick-shop__variants_value"
                  value="${value}"
                  option="${value}"
                >
                  ${value}
                </option>
              </select>
              {% render 'icon_arrow_right', icon_class: 'quick-shop__variant__select-icon' %}
            </div>
          </div>
        `
      }()}
    </div>
  </div>
</template>
<template id="quick-shop-selected-variant-template">
  <span class="inline-block truncate max-w-full" title="${data.value}">
    ${data.value}
  </span>
</template>
