{% assign postage_free_amount = settings.postage_free_amount | market_rate_exchange %}

{% if settings.free_shipping_tip and postage_free_amount > 0 %}
  <style>
    .cart_free_shipping[data-free-shipping="true"] {
      padding: 8px;
      color: var(--color-text-shipping-success);
      background-color: var(--color-background-shipping-success);
      border-radius: 2px;
    }

    .cart_free_shipping__progress_bar_wrap {
      height: 6px;
      background-color: #F6F6F6;
      border-radius: 1px;
    }

    .cart_free_shipping__progress_bar {
      border-radius: 1px;
      transition: all 1s;
      background: linear-gradient(90deg, #D2A43A 0%, #D93333 100%);
    }

    .cart_free_shipping_discount_color,
    .cart-free-shipping-percent {
      color: #D2A43A;
    }
  </style>

  ${(function(){
    var total_price = data.total_price;
    var postageFreeAmount = {{ postage_free_amount | minus: 0 }};
    var freeAmount = postageFreeAmount - total_price;
    var isFreeShipping = freeAmount <= 0;
    var rate = Math.min(total_price / postageFreeAmount * 100, 100).toFixed(2);
    const textArray = ({{ 'i18n.bag.general.enjoy_free_shopping' | t | json }}).split(/\{\{\s*amount\s*\}\}/);
    const textArrayHtml = textArray.map((text, index) => {
      if (index == 0) {
        return `<span>${text}</span>`;
      }

      return `<spz-currency class="cart_free_shipping_discount_color inline-block" layout="container" value="${freeAmount}"></spz-currency><span>${text}</span>`;
    }).join('');

    return `
      <div class="cart_free_shipping {{class}}" data-free-shipping="${!!isFreeShipping}">
        <div class="flex items-center leading-1.2">
          {% include 'icon_shipping_style', fill_color: settings.color_cart_dot_bg, icon_class: 'flex-shrink-0 mr-1' %}
          <div spz-if="${!isFreeShipping}">${textArrayHtml}</div>
          <div class="lg:body-plus-2" spz-else>{{ 'i18n.bag.general.free_shipping_text' | t }}</div>
        </div>
        <div class="cart_free_shipping__progress flex items-center mt-1" spz-if="${!isFreeShipping}">
          <div class="cart_free_shipping__progress_bar_wrap flex-1 relative">
            <div class="cart_free_shipping__progress_bar absolute h-full" style="width:${rate}%;"></div>
          </div>
          <span class="cart-free-shipping-percent flex-shrink-0 ml-1 tw-leading-1.2 body-minus-2">${rate}%</span>
        </div>
      </div>
    `
  })()}
{% endif %}
